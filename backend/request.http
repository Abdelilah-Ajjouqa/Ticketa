### Register Admin
# @name registerAdmin
POST http://localhost:3000/auth/register
Content-Type: application/json

{
    "username": "admin2",
    "email": "admin2@gmail.com",
    "password": "password123",
    "confirmPassword": "password123",
    "role": "admin"
}


### Login Admin
# @name loginAdmin
POST http://localhost:3000/auth/login
Content-Type: application/json

{
    "email": "admin@gmail.com",
    "password": "password123"
}

### Register Participant
# @name registerUser
POST http://localhost:3000/auth/register
Content-Type: application/json

{
    "username": "user",
    "email": "user@gmail.com",
    "password": "password123",
    "confirmPassword": "password123",
    "role": "participant"
}

### Login Participant
# @name loginUser
POST http://localhost:3000/auth/login
Content-Type: application/json

{
    "email": "user@gmail.com",
    "password": "password123"
}

### Get Current User (Protected)
GET http://localhost:3000/auth/me
Authorization: Bearer {{loginUser.response.body.accessToken}}

###
### ===== USER ROUTES (all protected now) =====
###

### Get Profile (Protected - returns user without password)
GET http://localhost:3000/user/profile
Authorization: Bearer {{loginUser.response.body.accessToken}}

### Get All Users (Admin Only - should fail for participant)
GET http://localhost:3000/user
Authorization: Bearer {{loginUser.response.body.accessToken}}

### Get All Users (Admin Only - should succeed)
GET http://localhost:3000/user
Authorization: Bearer {{loginAdmin.response.body.accessToken}}

### Get User by ID (Admin Only - should fail without token)
GET http://localhost:3000/user/33

### Get User by ID (Admin Only)
GET http://localhost:3000/user/507f1f77bcf86cd799439011
Authorization: Bearer {{loginAdmin.response.body.accessToken}}

### Update User (Admin Only - should fail for participant)
PATCH http://localhost:3000/user/507f1f77bcf86cd799439011
Authorization: Bearer {{loginUser.response.body.accessToken}}
Content-Type: application/json

{
    "username": "updateduser"
}

### Delete User (Admin Only - should fail for participant)
DELETE http://localhost:3000/user/507f1f77bcf86cd799439011
Authorization: Bearer {{loginUser.response.body.accessToken}}

### Get Admin Data (Protected - Should Fail for User)
GET http://localhost:3000/user/admin
Authorization: Bearer {{loginUser.response.body.accessToken}}

### Get Admin Data (Protected - Should Success for Admin)
GET http://localhost:3000/user/admin
Authorization: Bearer {{loginAdmin.response.body.accessToken}}

###
### ===== EXCEPTION FILTER TESTS =====
###

### Invalid ObjectId (should return 400, not 500)
GET http://localhost:3000/user/invalid-id-here
Authorization: Bearer {{loginAdmin.response.body.accessToken}}

### Invalid ObjectId on events
GET http://localhost:3000/events/not-a-valid-id

###
### ===== EVENT ROUTES =====
###

### Create Event (Admin)
# @name createEvent
POST http://localhost:3000/events
Authorization: Bearer {{loginAdmin.response.body.accessToken}}
Content-Type: application/json

{
    "title": "NestJS Workshop",
    "description": "Learn NestJS from scratch",
    "date": "2026-12-25T10:00:00.000Z",
    "location": "Online",
    "totalTickets": 100,
    "price": 20
}


### Get All Events (Public - Published Only)
GET http://localhost:3000/events


### Get All Events (Admin - All)
GET http://localhost:3000/events/admin
Authorization: Bearer {{loginAdmin.response.body.accessToken}}


### Publish Event (Admin)
PATCH http://localhost:3000/events/{{createEvent.response.body._id}}/publish
Authorization: Bearer {{loginAdmin.response.body.accessToken}}


### Cancel Event (Admin)
PATCH http://localhost:3000/events/{{createEvent.response.body._id}}/cancel
Authorization: Bearer {{loginAdmin.response.body.accessToken}}


### Delete Event (Admin)
DELETE http://localhost:3000/events/{{createEvent.response.body._id}}
Authorization: Bearer {{loginAdmin.response.body.accessToken}}

### Get Event Stats (Admin Only)
GET http://localhost:3000/events/stats
Authorization: Bearer {{loginAdmin.response.body.accessToken}}

### Get Event Stats (Participant - should fail 403)
GET http://localhost:3000/events/stats
Authorization: Bearer {{loginUser.response.body.accessToken}}

###
### ===== RESERVATION ROUTES =====
###

### Create Reservation (Participant - starts as PENDING)
# @name createReservation
POST http://localhost:3000/reservations
Authorization: Bearer {{loginUser.response.body.accessToken}}
Content-Type: application/json

{
    "eventId": "{{createEvent.response.body._id}}"
}

### Create Duplicate Reservation (should fail - already has active reservation)
POST http://localhost:3000/reservations
Authorization: Bearer {{loginUser.response.body.accessToken}}
Content-Type: application/json

{
    "eventId": "{{createEvent.response.body._id}}"
}

### Get All Reservations (Participant sees own)
GET http://localhost:3000/reservations
Authorization: Bearer {{loginUser.response.body.accessToken}}

### Get All Reservations (Admin sees all)
GET http://localhost:3000/reservations
Authorization: Bearer {{loginAdmin.response.body.accessToken}}

### Filter Reservations by Event (Admin)
GET http://localhost:3000/reservations?eventId={{createEvent.response.body._id}}
Authorization: Bearer {{loginAdmin.response.body.accessToken}}

### Filter Reservations by User (Admin)
GET http://localhost:3000/reservations?userId={{registerUser.response.body.user._id}}
Authorization: Bearer {{loginAdmin.response.body.accessToken}}

### Filter Reservations by Status (Admin)
GET http://localhost:3000/reservations?status=pending
Authorization: Bearer {{loginAdmin.response.body.accessToken}}

### Filter Reservations by Event + Status (Admin)
GET http://localhost:3000/reservations?eventId={{createEvent.response.body._id}}&status=confirmed
Authorization: Bearer {{loginAdmin.response.body.accessToken}}

### Filter own Reservations by Status (Participant)
GET http://localhost:3000/reservations?status=confirmed
Authorization: Bearer {{loginUser.response.body.accessToken}}

### Get Reservation by ID (Participant - own only)
GET http://localhost:3000/reservations/{{createReservation.response.body._id}}
Authorization: Bearer {{loginUser.response.body.accessToken}}

### Get Reservation by ID (Admin - can access any)
GET http://localhost:3000/reservations/{{createReservation.response.body._id}}
Authorization: Bearer {{loginAdmin.response.body.accessToken}}

### Download Ticket PDF (should FAIL - reservation is PENDING, not CONFIRMED)
GET http://localhost:3000/reservations/{{createReservation.response.body._id}}/pdf
Authorization: Bearer {{loginUser.response.body.accessToken}}

### Confirm Reservation (Admin only - changes PENDING â†’ CONFIRMED)
PATCH http://localhost:3000/reservations/{{createReservation.response.body._id}}/confirm
Authorization: Bearer {{loginAdmin.response.body.accessToken}}

### Download Ticket PDF (should SUCCEED now - reservation is CONFIRMED)
GET http://localhost:3000/reservations/{{createReservation.response.body._id}}/pdf
Authorization: Bearer {{loginUser.response.body.accessToken}}

### Refuse Reservation (Admin only - only works on PENDING, releases ticket)
### NOTE: Create a new reservation first to test this
PATCH http://localhost:3000/reservations/{{createReservation.response.body._id}}/refuse
Authorization: Bearer {{loginAdmin.response.body.accessToken}}

### Cancel Reservation (Owner or Admin)
DELETE http://localhost:3000/reservations/{{createReservation.response.body._id}}
Authorization: Bearer {{loginUser.response.body.accessToken}}